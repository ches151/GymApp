(function(){"use strict";function t(t,u,f,e,o,s,h,c,l,a,v,y){function k(n){d(n);g(n);it(n);b(p.exercises[0])}function d(n){c.title=n.name;p.workout=n;p.exercises=n.exercises}function g(){p.workoutSession=new r({dateStart:new Date,dateEnd:null});y.save(p.workoutSession)}function nt(){tt()}function tt(){p.workoutSession.dateEnd=new Date;y.save(p.workoutSession)}function it(n){var t=[],r=p.workoutSession.id;n.exercises.forEach(function(u,f){t.push([new i({exerciseId:u.id,workoutId:n.id,workoutSessionId:r,weight:null,unit:"kg",serialNumber:f,numberOfRepetitions:null})])});p.exerciseSets=t;t=null}function b(n){p.activeExercise=n}function rt(n){var t=p.exerciseSets[n];return t.length>1||t.length==1&&w(t[0])}function ut(i,r){var u=p.workoutSession.id,f=r.name;ft(r.id,u).then(function(t){o.show({controller:n,controllerAs:"ctrl",templateUrl:"app/partials/exerciseset-one-exercise.html",parent:angular.element(document.body),targetEvent:i,clickOutsideToClose:!0,fullscreen:!1,locals:{exerciseSets:t,exerciseName:f}})},function(n){t.warn(n.message)})}function ft(n,t){var i=s.defer();return v.getPrevExerciseSessionId({exerciseId:n,workoutSessionId:t},function(t){t&&t.value&&t.value.length&&v.getExercisesSetsFromSession({exerciseId:n,workoutSessionId:t.value[0].workoutSessionId},function(n){n&&n.value&&n.value.length?i.resolve(n.value):i.reject({message:"No previous exercise sets are available"})})}),i.promise}function et(n,t){switch(n.keyCode){case u.KEY_CODE.ENTER:case u.KEY_CODE.TAB:ot(t)}}function ot(n){var t=p.exerciseSets[n],r,u;lt(t)&&(r=t[t.length-1],r.date=new Date,u=p.workoutSession.id,t.push(new i({exerciseId:r.exerciseId,workoutId:r.workoutId,workoutSessionId:u,weight:null,unit:r.unit,serialNumber:t.length,numberOfRepetitions:null})))}function st(n,t,i){w(i)?ht(i):at(i)&&ct(t,i)}function ht(n){return n.id?v.update(n):(n.id=h.guid(),v.save(n))}function ct(n,t){var r=t.id,i,u;r&&v.remove({id:r});i=p.exerciseSets[n];i.length>1&&(u=i.indexOf(t),i.splice(u,1))}function lt(n){return n?n.every(function(n){return w(n)}):!1}function w(n){return n.weight>0&&n.numberOfRepetitions>0}function at(n){return!n.weight&&!n.numberOfRepetitions}t.log("gym.WorkoutSessionCtrl constructor");c.canGoBack=!0;var p=this;p.workoutId=f.workoutId;p.workout={};p.workoutSession=null;p.activeExercise={};p.exercises=[];p.exerciseSets=[];p.massUnits=l;p.setActiveExercise=b;p.showHistory=ut;p.onKeydown=et;p.onBlur=st;p.isExerciseAccomplished=rt;e.$on("$destroy",nt);a.query({id:p.workoutId},k)}function n(n,t,i){var r=this;r.exerciseName=t;r.exerciseSets=i;r.hide=function(){n.hide()};r.cancel=function(){n.cancel()}}function i(n){this.id=n.id;this.date=n.date;this.rowVersion=n.rowVersion;this.exerciseId=n.exerciseId;this.workoutId=n.workoutId;this.workoutSessionId=n.workoutSessionId;this.weight=n.weight;this.unit=n.unit;this.serialNumber=n.serialNumber;this.numberOfRepetitions=n.numberOfRepetitions}function r(n){this.id=n.id;this.dateStart=n.dateStart;this.dateEnd=n.dateEnd;this.rowVersion=n.rowVersion;this.exerciseSets=n.exerciseSets}angular.module("gym").controller("WorkoutSessionCtrl",t);t.$inject=["$log","$mdConstant","$routeParams","$scope","$mdDialog","$q","tools","header","massUnits","workoutsService","exerciseSetsService","workoutSessionsService"];angular.module("gym").controller("ExerciseSetOneExerciseCtrl",n);n.$inject=["$mdDialog","exerciseName","exerciseSets"]})();
//# sourceMappingURL=gym.workout-session-controller.min.js.map
